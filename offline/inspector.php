<?php
//start config -----------------------------------------------------------------------------------------------------------------------------
$config['localwwwurl']			= 'http://10.0.0.16/'; //with trailing slash and with http e.g http://localhost/
$config['databaseurl']			= '10.0.0.16'; //eg.http://localhost/
$config['database']				= 'phpinspector';
$config['mysqluser']			= 'phpinspector'; //this needs to have write and read privliges to the table "variables" eg. root
$config['mysqlpass']			= 'doctorrose'; //eg. password
$config['showbutton']			= TRUE; //wether to show the hide and launch inspector button on the page (TRUE or FALSE)
$config['requireauth']			= TRUE; //weather to require $_SESSION['inspector'] to be set before running - recomended for anything public
//end config -------------------------------------------------------------------------------------------------------------------------------


//do not edit below this line!!!
$zzzzzz=new mysqli($config['databaseurl'],$config['mysqluser'],$config['mysqlpass'],$config['database'])or die('unable to connect to db');@session_start();if($config['requireauth']){if(!isset($_SESSION['inspector'])&&isset($_GET['inspector'])){header('location:?');exit();}}if($config['requireauth']){if(!isset($_SESSION['inspector'])&&!isset($_GET['inspector'])){$config['showbutton']=FALSE;}}if(!isset($_GET['showerrors'])&&!isset($_GET['inspector'])){error_reporting(-1);showbutton('?inspector=1','Launch inspector');}else{error_reporting(-1);}function showbutton($b,$c){global $config;if($config['showbutton']){?> <!DOCTYPE html>
<style type="text/css">#inspectorbutton{ z-index:99999;background-color:#eee;opacity:0.7;display:inline-block; border:1px solid #ccc; position:fixed; bottom:15px; right:15px; } #inspectorbutton:hover{ opacity:1.0; }</style>
<div onclick="location.href='<?echo $b;?>'" id="inspectorbutton"><p style="margin: 22px;text-decoration:underline; font-weight:bold;" onclick="location.href='<?echo $b;?>'"><?echo $c;?></p></div>
<?php }}function getDefinedVars($d){$e=array('GLOBALS','_FILES','_COOKIE','_POST','_GET','excludeList','_ENV','HTTP_ENV_VARS','HTTP_POST_VARS','HTTP_GET_VARS','HTTP_COOKIE_VARS','_SERVER','HTTP_SERVER_VARS','HTTP_POST_FILES','_REQUEST','config','zzzzzz', '_SESSION', 'HTTP_SESSION_VARS');$f=array_values(array_diff(array_keys($d),$e));$g=array();while(list($h,$j)=each($f)){global$$j;$g[$j]=$$j;}return $g;}function senddbvars($k,$d){global $zzzzzz;$l=getDefinedVars($d);$m=array_keys($l);$n=FALSE;foreach($m as $o){echo $o.'  ';if(is_array($l[$o])){$l[$o]=urldecode(http_build_query($l[$o]));$l[$o]=str_replace("&","**htmlbr**",$l[$o]);$l[$o]=str_replace("="," = ",$l[$o]);}$p=mysqli_escape_string($zzzzzz,'$'.$o);$q=mysqli_escape_string($zzzzzz,$l[$o]);$r="INSERT INTO variables (rownum, varname, varvalue) VALUES ('$k', '{$p}', '$q')";mysqli_query($zzzzzz,$r);$n=TRUE;}if(!$n){$r="INSERT INTO variables (rownum, varname, varvalue) VALUES ('$k', '', '')";mysqli_query($zzzzzz,$r);}}if(isset($_GET['inspector'])){function isfound($s,$t){$u='/'.$s.'/i';preg_match($u,$t,$v);if(isset($v[0][1])){return TRUE;}else{return FALSE;}}function findvars($w,$x,$y){global $zzzzzz;$z=md5(rand()).'vars.php';$zzzzzza=$y.$z;$bb=preg_split('/\r\n|\r|\n/',$w);$cc=1;foreach($bb as $k){$dd['line']=$k;$dd['linenum']=$cc;$ee[]=$dd;$cc++;}$ff['line']='';$ff['linenum']='';$cc=1;$gg=FALSE;foreach($ee as $k){$hh=FALSE;if(preg_match("/;$/i",trim($ff['line']))){$hh=TRUE;}if(preg_match("/\{$/i",trim($ff['line']))){$hh=TRUE;}if(preg_match("/\}$/i",trim($ff['line']))){$hh=TRUE;}if(preg_match("/^\/\//i",trim($ff['line']))){$hh=TRUE;}if(trim($ff['line'])==''){$hh=TRUE;}if(preg_match("/\?>/i",trim($ff['line']))){$gg=FALSE;$hh=FALSE;}if(preg_match("/<\?php/i",trim($ff['line']))){$gg=TRUE;}if($hh){$iiiiiii[]="senddbvars('{$k['linenum']}', get_defined_vars());";}if(!$gg&&$cc>2){$iiiiiii[]="<?php senddbvars('{$k['linenum']}', get_defined_vars()); ?>";}$iiiiiii[]=$k['line'];$ff=$k;$cc++;}$jj=implode("\n",$iiiiiii);file_put_contents($zzzzzza,$jj);mysqli_query($zzzzzz,"DELETE FROM variables");$kk=file($x.$zzzzzza.'?showerrors=1');unlink($zzzzzza);if(isset($ll)){return TRUE;}else{return FALSE;}}function finderrors($w,$x,$y){$z=md5(rand()).'.php';$zzzzzza=$y.$z;file_put_contents($zzzzzza,$w);$kk=file($x.$zzzzzza.'?showerrors=1');unlink($zzzzzza);$cc=1;foreach($kk as $k){if(isfound($z,$k)){$ll=strip_tags($k);$mm=$k;$nn=$cc;}$cc++;}findvars($w,$x,$y);if(isset($ll)){preg_match('/(.*?) in <b>.*?<\/b> on line <b>(?P<errorline>\d+)<\/b>/',$mm,$oo);}if(isset($ll)){return $oo;}else{return FALSE;}}$cc=1;if(isset($_GET['line'])){$pp=$_GET['line'];$qq=$_GET['line'];}else{$pp=250;$qq=250;}$rr=explode('/',$_SERVER['PHP_SELF']);$ss=1;foreach($rr as $tt){if($ss!=count($rr)){$uu=$tt.'/';}$ss++;}$vv=$_SERVER['SCRIPT_FILENAME'];@$ww=strlen(end(explode('/',$vv)));$ww=0-$ww;$uu=substr($_SERVER['PHP_SELF'],0,$ww);$rr=end($rr);$oo=finderrors(file_get_contents($rr),$config['localwwwurl'].$uu,'');$bb=file($rr);foreach($bb as $k){if($cc==$oo[2]){$xx['line']=trim(htmlspecialchars($k));$xx['classes']='rederror hover';$xx['linenum']=$cc;$yy=TRUE;}else{$xx['line']=trim(htmlspecialchars($k));if($cc%2==0){$xx['classes']='altrow hover';}else{$xx['classes']='hover';}$xx['linenum']=$cc;}if($qq==$xx['linenum']){$xx['classes'].=' selected';}$zz[]=$xx;$cc++;}$zzzzzzaa=mysqli_query($zzzzzz,"SELECT * FROM variables WHERE rownum='$pp'");if(mysqli_num_rows($zzzzzzaa)>0){$ss=1;while($bbb=mysqli_fetch_array($zzzzzzaa)){$ccc['varname']=htmlspecialchars($bbb['varname']);$ccc['varvalue']=htmlspecialchars($bbb['varvalue']);$ccc['varvalue']=str_replace("**htmlbr**","<br>",$ccc['varvalue']);if($ss%2==0){$ccc['classes']='hover';}else{$ccc['classes']='altrow hover';}$ddd[]=$ccc;$ss++;}$eee=TRUE;}else{while(mysqli_num_rows($zzzzzzaa)<=0&&$pp>0){$pp=$pp-1;$zzzzzzaa=mysqli_query($zzzzzz,"SELECT * FROM variables WHERE rownum='$pp'");}if(mysqli_num_rows($zzzzzzaa)>0){$ss=1;while($bbb=mysqli_fetch_array($zzzzzzaa)){$ccc['varname']=htmlspecialchars($bbb['varname']);$ccc['varvalue']=htmlspecialchars($bbb['varvalue']);$ccc['varvalue']=str_replace("**htmlbr**","<br>",$ccc['varvalue']);if($ss%2==0){$ccc['classes']='hover';}else{$ccc['classes']='altrow hover';}$ddd[]=$ccc;$ss++;}$eee=TRUE;}else{$eee=FALSE;$ll=':/ PHP Inspector was unable to get the varibles on this line,<br>did u click on the first line?';}}?>
<html><head><title>PHP inspector</title><style type="text/css">#widthlock{ padding:0; margin:0; min-width:1200px; } table{ border-collapse:collapse; border:1px solid #aaa; margin-bottom:10px; } tr{ display:block; padding: 1px 0 1px 0; max-width:700px; } .linenum{ padding-left:5px; min-width:15px; padding-right:5px; } .linecode{ padding-right:8px; } .altrow{ background-color:#eee; } .rederror{ background-color:#faa; } #phperror{ font-size:14px; text-decoration:underline; } #scriptlines{ float:left; max-width:700px; } #varibledisplay{ float:right; margin-top:20px; margin-right:50px; } .title{ font-weight:bold; padding-top:5px; padding-bottom:7px;} .varname{ padding: 1px 3px 1px 3px; width: 160px; } .varvalue{ padding: 1px 3px 1px 15px; text-align:left; max-width:300px; } .selected{ background-color:#aaa !important; color:#fff; } .hover:hover{ background-color:#aaa !important; color:#fff; } </style></head><body><div id="widthlock"><?showbutton('?','Close inspector');?><div id="scriptlines"><?if(isset($yy)&&$yy){?><b>Error:</b> <span id="phperror"><?echo strip_tags($oo[1]);?></span><?}else{echo '<br>';}?><table border="0"><?php foreach($zz as $fff){?><tr class="<?echo $fff['classes']?>" onclick="location.href='?inspector=1&line=<?echo $fff['linenum']?>'"><td class="linenum"><?echo $fff['linenum']?></td><td class="linecode"><?echo $fff['line']?></td></tr><?}?></table></div><div id="varibledisplay"><?if($eee){?><table><tr class="title"><td class="varname">Varible name</td><td class="varvalue">Varible data</td></tr><?php foreach($ddd as $ggg){?><tr class="<?echo $ggg['classes']?>"><td class="varname"><?echo $ggg['varname'];?></td><td class="varvalue"><?echo $ggg['varvalue'];?></td></tr><?php }?></table><?}else{echo $ll;}?></div></div></body></html><?php exit();}?>